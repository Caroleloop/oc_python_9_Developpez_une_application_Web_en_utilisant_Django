{% extends 'base_feed.html' %}
{% block content %}
<main>
<h1>Abonnements</h1>

<form method="get" action="{% url 'subscriptions' %}">
    <input type="text" name="q" placeholder="Rechercher un utilisateur" value="{{ query|default:'' }}">
    <button type="submit">Search</button>
</form>

{% if query %}
    <h2>Results for "{{ query }}"</h2>
    {% if search_results %}
        <ul>
            {% for user in search_results %}
                <div class="ticket">
                    <strong>{{ user.username }}</strong>
                     {% if user in following %}
                        <p >- already followed</p>
                    {% else %}
                        <form method="post" action="{% url 'subscriptions' %}">
                            {% csrf_token %}
                            <input type="hidden" name="username" value="{{ user.username }}">
                            <button type="submit">Follow</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}
        </ul>
    {% else %}
        <p>No users found.</p>
    {% endif %}
{% endif %}

<hr>

<h2>Users I follow</h2>
{% if following %}
    {% for user in following %}
        <div class="ticket follow-item">
            <strong>{{ user.username }}</strong>
            <form method="post" action="{% url 'subscriptions' %}">
                {% csrf_token %}
                <input type="hidden" name="username" value="{{ user.username }}">
                <button class="delete-button" type="submit" >Unfollow</button>
            </form>
        </div>        
    {% endfor %}
    
{% else %}
    <p>You're not following anyone.</p>
{% endif %}

<hr>

<h3>Users who follow me</h3>
{% if followers %}
    {% for user in followers %}
        <div class="ticket">
            <strong>{{ user.username }}</strong>
        </div>
    {% endfor %}
{% else %}
    <p>No user is following you.</p>
{% endif %}
</main>
{% endblock %}